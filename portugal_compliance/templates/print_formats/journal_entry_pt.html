<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ doc.name }} - Lan√ßamento Contabil√≠stico</title>
    <style>
        /* Estilos para lan√ßamento contabil√≠stico portugu√™s */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 11px;
            line-height: 1.4;
            color: #333;
            margin: 0;
            padding: 20px;
        }

        .journal-entry-container {
            max-width: 210mm;
            margin: 0 auto;
            background: white;
            border: 2px solid #17a2b8;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
            border-bottom: 2px solid #17a2b8;
            padding-bottom: 20px;
        }

        .company-info {
            flex: 1;
        }

        .company-logo {
            max-width: 150px;
            max-height: 80px;
            margin-bottom: 10px;
        }

        .company-name {
            font-size: 18px;
            font-weight: bold;
            color: #17a2b8;
            margin-bottom: 5px;
        }

        .company-details {
            font-size: 10px;
            line-height: 1.3;
        }

        .document-info {
            text-align: right;
            flex: 0 0 200px;
        }

        .document-title {
            font-size: 24px;
            font-weight: bold;
            color: #17a2b8;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .document-number {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .document-dates {
            font-size: 10px;
        }

        .journal-notice {
            background-color: #d1ecf1;
            border: 2px solid #17a2b8;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
            border-radius: 5px;
        }

        .notice-title {
            font-size: 16px;
            font-weight: bold;
            color: #17a2b8;
            margin-bottom: 10px;
        }

        .entry-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }

        .entry-details, .voucher-info {
            flex: 1;
            margin-right: 20px;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #17a2b8;
        }

        .section-title {
            font-weight: bold;
            color: #17a2b8;
            border-bottom: 1px solid #17a2b8;
            padding-bottom: 3px;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .accounts-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .accounts-table th {
            background-color: #17a2b8;
            color: white;
            padding: 8px;
            text-align: left;
            font-weight: bold;
            border: 1px solid #17a2b8;
        }

        .accounts-table td {
            padding: 6px 8px;
            border: 1px solid #ddd;
            vertical-align: top;
        }

        .accounts-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .debit-amount {
            color: #28a745;
            font-weight: bold;
        }

        .credit-amount {
            color: #dc3545;
            font-weight: bold;
        }

        .atcud-section {
            background-color: #f0f8ff;
            border: 2px solid #17a2b8;
            padding: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .atcud-code {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: bold;
            color: #17a2b8;
            letter-spacing: 1px;
        }

        .qr-code {
            margin: 10px 0;
        }

        .totals-section {
            background-color: #e9ecef;
            border: 2px solid #17a2b8;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .totals-table {
            width: 100%;
            border-collapse: collapse;
        }

        .totals-table td {
            padding: 8px;
            border-bottom: 1px solid #ddd;
            font-weight: bold;
        }

        .balance-check {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            text-align: center;
        }

        .balance-error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .references-section {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .signature-section {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            gap: 20px;
        }

        .signature-box {
            flex: 1;
            text-align: center;
            border: 1px solid #ddd;
            padding: 40px 10px 10px 10px;
            border-radius: 5px;
            background-color: #f8f9fa;
        }

        .signature-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #17a2b8;
        }

        .signature-line {
            border-top: 1px solid #333;
            margin: 30px 0 5px 0;
        }

        .legal-notes {
            font-size: 9px;
            color: #666;
            margin-top: 20px;
            line-height: 1.3;
        }

        .footer-info {
            margin-top: 30px;
            border-top: 1px solid #ddd;
            padding-top: 20px;
        }

        .text-right {
            text-align: right;
        }

        .text-center {
            text-align: center;
        }

        @media print {
            body {
                padding: 0;
            }

            .journal-entry-container {
                border: none;
                padding: 0;
            }

            .page-break {
                page-break-before: always;
            }
        }
    </style>
</head>
<body>
    <div class="journal-entry-container">
        <!-- Cabe√ßalho -->
        <div class="header">
            <div class="company-info">
                {% if doc.company_logo %}
                <img src="{{ doc.company_logo }}" alt="Logo" class="company-logo">
                {% endif %}
                <div class="company-name">{{ frappe.db.get_value("Company", doc.company, "company_name") }}</div>
                <div class="company-details">
                    {% set company_address = frappe.db.get_value("Address", {"is_your_company_address": 1, "link_name": doc.company}, ["address_line1", "address_line2", "city", "pincode", "country"], as_dict=True) %}
                    {% if company_address %}
                    {{ company_address.address_line1 }}<br>
                    {% if company_address.address_line2 %}{{ company_address.address_line2 }}<br>{% endif %}
                    {{ company_address.pincode }} {{ company_address.city }}<br>
                    {{ company_address.country }}
                    {% endif %}
                    <br>
                    <strong>NIF:</strong> {{ frappe.db.get_value("Company", doc.company, "tax_id") }}<br>
                    {% set company_phone = frappe.db.get_value("Contact", {"is_primary_contact": 1, "link_name": doc.company}, "phone") %}
                    {% if company_phone %}<strong>Tel:</strong> {{ company_phone }}<br>{% endif %}
                    {% set company_email = frappe.db.get_value("Contact", {"is_primary_contact": 1, "link_name": doc.company}, "email_id") %}
                    {% if company_email %}<strong>Email:</strong> {{ company_email }}{% endif %}
                </div>
            </div>

            <div class="document-info">
                <div class="document-title">Lan√ßamento Contabil√≠stico</div>
                <div class="document-number">{{ doc.name }}</div>
                <div class="document-dates">
                    <strong>Data:</strong> {{ frappe.utils.formatdate(doc.posting_date, "dd/MM/yyyy") }}<br>
                    <strong>Criado:</strong> {{ frappe.utils.formatdate(doc.creation, "dd/MM/yyyy HH:mm") }}
                </div>
            </div>
        </div>

        <!-- Aviso de Lan√ßamento Contabil√≠stico -->
        <div class="journal-notice">
            <div class="notice-title">üìä LAN√áAMENTO CONTABIL√çSTICO üìä</div>
            <div>Documento que regista <strong>MOVIMENTOS CONTABIL√çSTICOS</strong> no raz√£o geral</div>
            <div>Tipo: <strong>{{ doc.voucher_type or "Lan√ßamento Manual" }}</strong></div>
        </div>

        <!-- ATCUD Section -->
        {% if doc.atcud_code %}
        <div class="atcud-section">
            <div><strong>C√≥digo √önico de Documento (ATCUD)</strong></div>
            <div class="atcud-code">{{ doc.atcud_code }}</div>
            {% if doc.qr_code_image %}
            <div class="qr-code">
                <img src="{{ doc.qr_code_image }}" alt="QR Code" style="width: 80px; height: 80px;">
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Informa√ß√µes do Lan√ßamento -->
        <div class="entry-info">
            <div class="entry-details">
                <div class="section-title">üìù Detalhes do Lan√ßamento</div>
                <strong>Tipo de Voucher:</strong> {{ doc.voucher_type or "Lan√ßamento Manual" }}<br>
                <strong>Data de Lan√ßamento:</strong> {{ frappe.utils.formatdate(doc.posting_date, "dd/MM/yyyy") }}<br>
                <strong>Utilizador:</strong> {{ doc.owner }}<br>
                <strong>Estado:</strong>
                {% if doc.docstatus == 1 %}
                <span style="color: #28a745; font-weight: bold;">Submetido</span>
                {% elif doc.docstatus == 2 %}
                <span style="color: #dc3545; font-weight: bold;">Cancelado</span>
                {% else %}
                <span style="color: #ffc107; font-weight: bold;">Rascunho</span>
                {% endif %}
            </div>

            <div class="voucher-info">
                <div class="section-title">üîó Informa√ß√µes de Refer√™ncia</div>
                {% if doc.cheque_no %}
                <strong>N¬∫ do Cheque:</strong> {{ doc.cheque_no }}<br>
                {% endif %}
                {% if doc.cheque_date %}
                <strong>Data do Cheque:</strong> {{ frappe.utils.formatdate(doc.cheque_date, "dd/MM/yyyy") }}<br>
                {% endif %}
                {% if doc.user_remark %}
                <strong>Observa√ß√µes:</strong> {{ doc.user_remark }}<br>
                {% endif %}
                <strong>Moeda Base:</strong> {{ frappe.db.get_value("Company", doc.company, "default_currency") }}
            </div>
        </div>

        <!-- Descri√ß√£o do Lan√ßamento -->
        {% if doc.user_remark %}
        <div class="references-section">
            <div class="section-title">üìÑ Descri√ß√£o do Lan√ßamento</div>
            {{ doc.user_remark }}
        </div>
        {% endif %}

        <!-- Tabela de Contas -->
        <table class="accounts-table">
            <thead>
                <tr>
                    <th style="width: 15%;">Conta</th>
                    <th style="width: 25%;">Descri√ß√£o da Conta</th>
                    <th style="width: 20%;">Contra Conta</th>
                    <th style="width: 12%;" class="text-right">D√©bito</th>
                    <th style="width: 12%;" class="text-right">Cr√©dito</th>
                    <th style="width: 16%;">Observa√ß√µes</th>
                </tr>
            </thead>
            <tbody>
                {% for account in doc.accounts %}
                <tr>
                    <td>
                        <strong>{{ account.account }}</strong>
                        {% if account.account_currency and account.account_currency != frappe.db.get_value("Company", doc.company, "default_currency") %}
                        <br><small>({{ account.account_currency }})</small>
                        {% endif %}
                    </td>
                    <td>
                        {{ frappe.db.get_value("Account", account.account, "account_name") }}
                        {% if account.party_type and account.party %}
                        <br><small><strong>{{ account.party_type }}:</strong> {{ account.party }}</small>
                        {% endif %}
                    </td>
                    <td>{{ account.against_account or "-" }}</td>
                    <td class="text-right">
                        {% if account.debit_in_account_currency %}
                        <span class="debit-amount">{{ frappe.utils.fmt_money(account.debit_in_account_currency, precision=2, currency=account.account_currency) }}</span>
                        {% else %}
                        -
                        {% endif %}
                    </td>
                    <td class="text-right">
                        {% if account.credit_in_account_currency %}
                        <span class="credit-amount">{{ frappe.utils.fmt_money(account.credit_in_account_currency, precision=2, currency=account.account_currency) }}</span>
                        {% else %}
                        -
                        {% endif %}
                    </td>
                    <td>
                        {% if account.reference_type and account.reference_name %}
                        <strong>{{ account.reference_type }}:</strong> {{ account.reference_name }}
                        {% endif %}
                        {% if account.user_remark %}
                        <br><small>{{ account.user_remark }}</small>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Totais -->
        <div class="totals-section">
            <div class="section-title">üí∞ Resumo dos Totais</div>
            <table class="totals-table">
                <tr>
                    <td style="width: 70%;">Total de D√©bitos:</td>
                    <td class="text-right debit-amount">{{ frappe.utils.fmt_money(doc.total_debit, precision=2, currency=frappe.db.get_value("Company", doc.company, "default_currency")) }}</td>
                </tr>
                <tr>
                    <td>Total de Cr√©ditos:</td>
                    <td class="text-right credit-amount">{{ frappe.utils.fmt_money(doc.total_credit, precision=2, currency=frappe.db.get_value("Company", doc.company, "default_currency")) }}</td>
                </tr>
                <tr style="border-top: 2px solid #17a2b8;">
                    <td><strong>Diferen√ßa:</strong></td>
                    <td class="text-right">
                        <strong>{{ frappe.utils.fmt_money(doc.difference, precision=2, currency=frappe.db.get_value("Company", doc.company, "default_currency")) }}</strong>
                    </td>
                </tr>
            </table>
        </div>

        <!-- Verifica√ß√£o de Equil√≠brio -->
        <div class="balance-check {% if doc.difference != 0 %}balance-error{% endif %}">
            {% if doc.difference == 0 %}
            <strong>‚úÖ LAN√áAMENTO EQUILIBRADO</strong><br>
            Os d√©bitos e cr√©ditos est√£o balanceados corretamente
            {% else %}
            <strong>‚ùå LAN√áAMENTO DESEQUILIBRADO</strong><br>
            Diferen√ßa de {{ frappe.utils.fmt_money(doc.difference, precision=2, currency=frappe.db.get_value("Company", doc.company, "default_currency")) }} - Verificar lan√ßamentos
            {% endif %}
        </div>

        <!-- Refer√™ncias de Documentos -->
        {% set has_references = false %}
        {% for account in doc.accounts %}
            {% if account.reference_type and account.reference_name %}
                {% set has_references = true %}
            {% endif %}
        {% endfor %}

        {% if has_references %}
        <div class="references-section">
            <div class="section-title">üîó Documentos de Refer√™ncia</div>
            {% for account in doc.accounts %}
                {% if account.reference_type and account.reference_name %}
                <strong>{{ account.reference_type }}:</strong> {{ account.reference_name }}
                {% if account.reference_due_date %}
                (Vencimento: {{ frappe.utils.formatdate(account.reference_due_date, "dd/MM/yyyy") }})
                {% endif %}
                <br>
                {% endif %}
            {% endfor %}
        </div>
        {% endif %}

        <!-- Informa√ß√µes Contabil√≠sticas -->
        <div class="references-section">
            <div class="section-title">üìö Informa√ß√µes Contabil√≠sticas</div>
            <strong>Per√≠odo Contabil√≠stico:</strong> {{ frappe.utils.formatdate(doc.posting_date, "MM/yyyy") }}<br>
            <strong>Exerc√≠cio Fiscal:</strong> {{ frappe.utils.get_fiscal_year(doc.posting_date, company=doc.company)[0] }}<br>
            <strong>M√©todo de Contabiliza√ß√£o:</strong> Partidas Dobradas<br>
            <strong>Princ√≠pio Contabil√≠stico:</strong> Acr√©scimo (Regime Geral)<br>
            <strong>Norma Aplic√°vel:</strong> SNC - Sistema de Normaliza√ß√£o Contabil√≠stica
        </div>

        <!-- Assinaturas -->
        <div class="signature-section">
            <div class="signature-box">
                <div class="signature-title">Preparado por</div>
                <div class="signature-line"></div>
                <div>{{ doc.owner }}</div>
                <small>T√©cnico de Contabilidade</small>
            </div>

            <div class="signature-box">
                <div class="signature-title">Revisto por</div>
                <div class="signature-line"></div>
                <div>A preencher</div>
                <small>Contabilista Certificado</small>
            </div>

            <div class="signature-box">
                <div class="signature-title">Aprovado por</div>
                <div class="signature-line"></div>
                <div>A preencher</div>
                <small>Respons√°vel Financeiro</small>
            </div>
        </div>

        <!-- Informa√ß√µes Legais -->
        <div class="legal-notes">
            <strong>Informa√ß√µes Legais:</strong><br>
            ‚Ä¢ Documento processado por programa certificado n.¬∫ {{ frappe.db.get_value("Company", doc.company, "at_certificate_number") or "XXXX/AT" }}<br>
            ‚Ä¢ Lan√ßamento contabil√≠stico conforme SNC - Sistema de Normaliza√ß√£o Contabil√≠stica<br>
            ‚Ä¢ Documento sujeito aos princ√≠pios das partidas dobradas<br>
            ‚Ä¢ Conservar este documento por per√≠odo m√≠nimo de 10 anos<br>
            ‚Ä¢ Lan√ßamento registado no livro di√°rio e raz√£o geral<br>
            ‚Ä¢ Processado por {{ frappe.session.user }} em {{ frappe.utils.now() }}
        </div>

        <!-- Rodap√© -->
        <div class="footer-info text-center">
            <small>
                Este documento foi gerado automaticamente pelo sistema ERPNext com o m√≥dulo Portugal Compliance<br>
                Para mais informa√ß√µes visite: {{ frappe.utils.get_url() }}
            </small>
        </div>
    </div>
</body>
</html>
